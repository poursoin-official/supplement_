<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>サプリ診断フォーム</title>
<link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@300;400;500&display=swap" rel="stylesheet" />
<style>
  body {
    font-family: 'Noto Sans JP', sans-serif;
    background: #f5f5f5;
    margin: 0; padding: 20px;
    max-width: 800px;
    margin-left: auto;
    margin-right: auto;
  }
  .container {
    background: #fff;
    padding: 30px 30px 40px;
    border-radius: 8px;
    box-shadow: 0 4px 6px rgba(0,0,0,0.1);
  }
  h1 {
    text-align: center;
    color: #333;
    margin-bottom: 30px;
    font-weight: 500;
  }
  .question-group {
    display: grid;
    grid-template-columns: repeat(auto-fit,minmax(280px,1fr));
    gap: 12px;
  }
  label {
    display: flex;
    align-items: center;
    background: #fafafa;
    padding: 10px 12px;
    border-radius: 5px;
    cursor: pointer;
    user-select: none;
    transition: background-color 0.2s ease;
    font-weight: 400;
    font-size: 14px;
  }
  label:hover {
    background: #eee;
  }
  input[type="checkbox"] {
    margin-right: 10px;
    width: 18px;
    height: 18px;
    cursor: pointer;
  }
  button {
    display: block;
    margin: 30px auto 0;
    padding: 12px 48px;
    background-color: #333;
    color: #fff;
    border: none;
    border-radius: 30px;
    font-size: 16px;
    font-weight: 500;
    cursor: pointer;
    transition: background-color 0.3s ease;
  }
  button:hover {
    background-color: #555;
  }
  .result {
    display: none;
    margin-top: 40px;
    padding: 25px;
    background: #fff;
    border-radius: 8px;
    box-shadow: 0 4px 8px rgba(0,0,0,0.1);
  }
  .result h2 {
    text-align: center;
    color: #222;
    margin-bottom: 25px;
    font-weight: 500;
  }
  .supplements {
    display: grid;
    grid-template-columns: repeat(auto-fit,minmax(220px,1fr));
    gap: 24px;
  }
  .supplement {
    text-align: center;
    font-size: 14px;
  }
  .supplement img {
    width: 110px;
    height: 110px;
    object-fit: contain;
    margin-bottom: 12px;
  }
  .supplement strong {
    display: block;
    font-weight: 600;
    margin-bottom: 6px;
  }
  .stars {
    display: flex;
    justify-content: center;
    font-size: 1.3em;
    margin-bottom: 10px;
    user-select: none;
  }
  .star { color: #ddd; }
  .star.full { color: gold; }
  .star.half {
    position: relative;
    color: transparent;
    display: inline-block;
  }
  .star.half::before {
    content: '★';
    position: absolute;
    left: 0;
    width: 50%;
    overflow: hidden;
    color: gold;
  }
  .star.half::after {
    content: '★';
    position: absolute;
    left: 0;
    color: #ddd;
  }
  @media (max-width: 480px) {
    .question-group {
      grid-template-columns: 1fr;
    }
    .supplements {
      grid-template-columns: 1fr;
    }
  }
</style>
</head>
<body>
  <div class="container">
    <h1>あなたのおすすめサプリ診断</h1>
    <form id="form" onsubmit="return false;">
      <div id="questionArea" class="question-group"></div>
      <button type="button" onclick="showResult()">診断する</button>
    </form>
    <div id="result" class="result"></div>
  </div>

<script>
  // 質問文（30個）
  const questions = [
    "最近、肌のハリや弾力が急に低下したと感じる",
    "関節や靭帯が固く、動きはじめに痛みを感じやすい",
    "目尻やほうれい線などのシワが目立ってきた",
    "仕事終わりに“電池切れ”のような極端な疲労感がある",
    "口内炎や口角炎ができやすい",
    "ストレスがかかるとすぐイライラしがち",
    "朝起きても疲れが抜けず、倦怠感が残る",
    "あざや内出血ができやすい",
    "かすり傷や切り傷の治りが遅い",
    "歯ぐきからの出血や腫れが気になる",
    "髪が抜けやすく、ツヤやコシがなくなった",
    "爪が割れたり、縦スジが目立つ",
    "乾燥性の皮膚炎や湿疹が繰り返し出る",
    "顔色が青白く、立ちくらみや動悸を感じやすい",
    "爪がスプーン状に反り返っている",
    "夕方以降に“こむら返り”や足のつりが起こる",
    "牛乳・乳製品をあまり摂らず、骨折リスクが気になる",
    "激しい運動後に強い筋肉痛や疲労が長引く",
    "お酒を飲むと翌朝まで二日酔いが残りやすい",
    "紫外線や睡眠不足など“酸化ストレス”に心当たりが多い",
    "BMI25以上またはウエスト周囲径（男性85cm／女性90cm）以上",
    "間食や夜食の習慣があり、血糖値の乱高下を感じる",
    "食後すぐに空腹感が戻り、ドカ食いしてしまうことが多い",
    "体重は減らしたいが筋肉量は落としたくない",
    "仕事や家事のプレッシャーで常に交感神経が高ぶっている",
    "寝つきが悪く、夜中に何度も目が覚める",
    "血圧が高め（診察室血圧 130/80 mmHg 以上）と言われた",
    "食後に胃もたれ・膨満感が長く続く",
    "加熱食中心で、生野菜や発酵食品をあまり摂らない",
    "加齢やストレスで基礎代謝が落ち、太りやすくなった実感がある"
  ];

  // 各質問の推奨サプリ（カンマ区切り 複数可）
  const assign = [
    "collagen",
    "collagen",
    "collagen",
    "vitaminB",
    "vitaminB",
    "vitaminB,gaba",
    "vitaminB,gaba",
    "vitaminC",
    "vitaminC,collagen",
    "vitaminC",
    "biotin,collagen",
    "biotin",
    "biotin,vitaminC",
    "iron",
    "iron",
    "iron",
    "iron",
    "antioxidant,vitaminB",
    "antioxidant",
    "antioxidant,collagen",
    "diet",
    "diet,vitaminB",
    "diet,enzyme",
    "diet,collagen",
    "gaba,antioxidant",
    "gaba",
    "gaba",
    "enzyme",
    "enzyme,vitaminC",
    "enzyme,diet"
  ];

  // サプリ情報
  const data = {
    collagen: { title: "バイオコラーゲン EX", img: "./img/9.png", desc: "肌や関節のハリ・弾力にアプローチします。" },
    vitaminB: { title: "ビーコン EX", img: "./img/8.png", desc: "エネルギー代謝や疲労回復に。" },
    vitaminC: { title: "ビタC1300", img: "./img/5.png", desc: "免疫サポートや抗酸化に。" },
    biotin:   { title: "ビオチン EX", img: "./img/6.png", desc: "肌・髪・爪の健康維持に。" },
    iron:     { title: "ヘムカル EX", img:"./img/12.png", desc: "貧血や骨の健康が気になる方に" },
    antioxidant: { title: "水素姫EX", img:"./img/4.png", desc:"酸化ストレスやストレス緩和に。" },
    diet:     { title: "SOP-EX", img:"./img/10.png", desc:"代謝・ダイエットサポートに。" },
    enzyme:   { title: "美活酵素", img:"./img/11.png", desc:"酵素と植物成分で内側からケア。" },
    gaba:     { title: "新のGABA", img:"./img/1.png", desc:"リラックス・ストレス緩和に。" }
  };

  // 質問を画面に表示
  const questionArea = document.getElementById('questionArea');
  questions.forEach((q, i) => {
    // checkbox idを固有に設定
    const id = 'q' + i;
    // label内にinputを埋め込む
    const label = document.createElement('label');
    label.htmlFor = id;
    label.innerHTML = `<input type="checkbox" id="${id}" value="${i}" />${q}`;
    questionArea.appendChild(label);
  });

  // 星の表示HTMLを生成
  // rating: 5〜0の範囲で半分単位（例: 4.5, 3.5）
  function createStars(rating) {
    let starsHtml = '';
    for(let i = 1; i <= 5; i++) {
      if(rating >= i) {
        starsHtml += '<span class="star full">★</span>';
      } else if(rating >= i - 0.5) {
        starsHtml += '<span class="star half">★</span>';
      } else {
        starsHtml += '<span class="star">★</span>';
      }
    }
    return `<div class="stars">${starsHtml}</div>`;
  }

  // 診断結果を表示
  function showResult() {
    const checked = [...document.querySelectorAll('input[type="checkbox"]:checked')];
    if(checked.length === 0){
      alert("少なくとも1つ以上チェックしてください。");
      return;
    }

    // サプリごとにスコア加算
    const score = {};
    checked.forEach(input => {
      const idx = parseInt(input.value, 10);
      const supplements = assign[idx].split(',');
      supplements.forEach(sup => {
        if(!score[sup]) score[sup] = 0;
        score[sup]++;
      });
    });

    // スコアがあるサプリのみ抽出し降順ソート
    const sorted = Object.entries(score).sort((a,b) => b[1] - a[1]);

    // TOP3抽出（スコアがないサプリは除外）
    const top3 = sorted.slice(0,3);

    // 星評価は固定で、1位=★5、2位=★4.5〜4、3位=★4〜3.5 のパターンを実装
    // 例として2位は4.5、3位は4で固定
    const starsRating = [5, 4.5, 4];

    // 結果HTML作成
    const resultDiv = document.getElementById('result');
    let html = '<h2>おすすめのサプリTOP3</h2><div class="supplements">';
    top3.forEach(([key, val], i) => {
      const sup = data[key];
      if(!sup) return; // データない場合は無視
      html += `<div class="supplement">
        <img src="${sup.img}" alt="${sup.title}" />
        <strong>${sup.title}</strong>
        ${createStars(starsRating[i])}
        <p>${sup.desc}</p>
      </div>`;
    });
    html += '</div>';
    resultDiv.innerHTML = html;
    resultDiv.style.display = 'block';

    // 画面下へスクロール
    resultDiv.scrollIntoView({behavior:"smooth"});
  }
</script>
</body>
</html>
